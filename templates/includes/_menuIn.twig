{# includes/_menuIn.twig #}
{% set menuItems   = craft.entries.section('menu').all() %}
{% set currentPath = craft.app.request.getPathInfo() %}
{% set baseUrl     = craft.app.request.getHostInfo() %}

{% set headerGlobal = craft.app.globals.getSetByHandle('header') ?? null %}
{% set headerObj    = (header is defined and header) ? header : headerGlobal %}
{% set logo         = (headerObj and headerObj.image|length) ? headerObj.image.one() : null %}

{% set formattedMenu = [] %}
{% for item in menuItems %}
  {% set type = (item.optional ?? '')|lower %}
  {% set url = '#' %}
  {% if type == 'post' and item.post|length %}
    {% set url = item.post.one().url %}
  {% elseif type == 'category' and item.catField|length %}
    {% set url = item.catField.one().url %}
  {% elseif type == 'directlink' and item.directLink is not empty %}
    {% set url = item.directLink %}
  {% endif %}
  {% set isExternal = (type == 'directlink') %}
  {% set menuPath   = url|replace({ (baseUrl ~ '/'): '' }) %}
  {% set isActive   = (not isExternal) and (menuPath == currentPath) %}
  {% set formattedMenu = formattedMenu|merge([{
    title: item.title,
    url: url,
    active: isActive,
    external: isExternal
  }]) %}
{% endfor %}

{% set languageHtml %}
  {% include './includes/_language.twig' %}
{% endset %}

{# --- MOBIL: fixen fent, de nem dupláz zászlót --- #}
<nav
  id="mobile-header-wrap"
  class="block md:hidden fixed top-0 left-0 w-full z-50 bg-primary shadow-lg"
  aria-label="{{ 'Fő navigáció'|t }}"
>
  {% include './includes/_menu' with { id: 'mobile-header' } %}
</nav>

{# --- DESKTOP: lekerekített, zászlós, fixen fent --- #}
<header
  id="{{ id ?? 'site-header-in' }}"
  data-logo-url="{{ logo ? logo.url : '' }}"
  data-logo-alt="{{ logo ? (logo.alt ?? logo.title ?? siteName ?? '') : '' }}"
  data-language="{{ languageHtml|e('html_attr') }}"
  data-menu="{{ formattedMenu|json_encode|e('html_attr') }}"
  class="w-full fixed top-0 left-0 right-0 z-40 hidden md:block transition-all duration-300 ease-in-out"
  role="banner"
>
<nav aria-label="{{ 'Fő navigáció'|t }}" class="w-full text-white">
  <div class="bg-primary rounded-b-3xl shadow-lg mx-5">
    <div class="max-w-8xl mx-auto flex items-center justify-between gap-4 py-3 px-5">
      <a href="{{ siteUrl }}"
         class="inline-flex items-center gap-2 focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-white rounded-md"
         aria-label="{{ siteName }}">
        {% if logo %}
          <img src="{{ logo.url }}" alt="{{ siteName }}" class="h-10 w-auto" loading="lazy" decoding="async">
        {% else %}
          <span class="text-lg font-semibold">{{ siteName }}</span>
        {% endif %}
      </a>

      <ul class="hidden md:flex items-center gap-1" role="list" id="primary-menu">
        {% for it in formattedMenu %}
          <li>
            <a href="{{ it.url }}"
               class="px-3 py-2 rounded-md inline-flex items-center gap-2
                      hover:bg-white/10
                      focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-white
                      {% if it.active %} bg-white/20 {% endif %}"
               {% if it.active %} aria-current="page"{% endif %}
               {% if it.external %} target="_blank" rel="noopener noreferrer"{% endif %}>
              <span>{{ it.title }}</span>
              {% if it.external %}
                <svg class="w-4 h-4" viewBox="0 0 20 20" aria-hidden="true" focusable="false">
                  <path fill="currentColor" d="M7 5h8v8h-2V8.414l-8.293 8.293-1.414-1.414L11.586 7H7V5z"/>
                </svg>
                <span class="sr-only">{{ ' (külső hivatkozás)'|t }}</span>
              {% endif %}
            </a>
          </li>
        {% endfor %}
      </ul>

      <div class="hidden md:block">
        {% include './includes/_language.twig' %}
      </div>
    </div>
  </div>
</nav>



</header>

{# tartalom alá ne csússzon desktopon #}
<div class="hidden md:block pt-24 lg:pt-28"></div>
